{"dependencies":[{"name":"/home/akiohayakawa/workspace/browser_editor/package.json","includedInParent":true,"mtime":1532065308636},{"name":"./misc/Definitions","loc":{"line":1,"column":24}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.tradeOffGraph=exports.learningCurveGraph=void 0;var t=require(\"./misc/Definitions\"),r=a(t);function a(t){return t&&t.__esModule?t:{default:t}}var e={margin:r.default.GRAPH.MARGIN,width:r.default.GRAPH.WINDOW_SIZE.WIDTH-r.default.GRAPH.MARGIN.RIGHT-r.default.GRAPH.MARGIN.LEFT,height:r.default.GRAPH.WINDOW_SIZE.HEIGHT-r.default.GRAPH.MARGIN.TOP-r.default.GRAPH.MARGIN.BOTTOM,svgWidth:r.default.GRAPH.WINDOW_SIZE.WIDTH,svgHeight:r.default.GRAPH.WINDOW_SIZE.HEIGHT,chartSVGWidth:r.default.GRAPH.SIZE.WIDTH,chartSVGHeight:r.default.GRAPH.SIZE.HEIGHT,zoomY:void 0,svg:void 0,calcTranslate:function(t){var r=t.translate(),a=this.svgHeight*(1-t.scale());return 0<r[1]?[0,0]:r[1]<a?[0,a]:r},addSVG:function(t){return d3.select(\".result-\"+this.type).append(\"svg\").attr({width:this.svgWidth,height:this.svgHeight}).style({\"background-color\":\"white\"}).call(t)},addAxisScale:function(t,r,a,e,i){return t.append(\"g\").attr({class:a+\" \"+this.type,transform:e,stroke:i,fill:\"none\"}).call(r)},addGrid:function(t,r,a,e,i){t.append(\"g\").attr({class:a+\" \"+this.type,transform:e,stroke:i}).call(r)},addPath:function(t,r,a,e,i,n){var o=t.append(\"path\");return i&&o.datum(i),o.attr({d:r,stroke:a,fill:\"none\",\"stroke-width\":e}),n&&o.attr(n),o},createLinePath:function(t,r,a,e){var i=this,n=d3.svg.line().x(function(r){return t(a(r))-i.margin.LEFT}).y(function(t){return r(e(t))-i.margin.TOP});return\"trade-off\"==this.type&&n.interpolate(\"step-after\"),n},addLabel:function(t,r,a,e){d3.select(t+\".\"+this.type).append(\"text\").text(r).attr(\"x\",a).attr(\"y\",e)},addChartSVG:function(t){return t.append(\"svg\").attr({width:this.chartSVGWidth,height:this.chartSVGHeight,x:this.margin.LEFT,y:this.margin.TOP})},zoom:function(t){this.zoomY.scale(t),this.zoomY.event(this.svg)},changeZoomArrayIndex:function(t){var r=d3.event.sourceEvent.wheelDelta,a=t.percentages.indexOf(t.percentage);r>=120&&a!==t.percentages.length-1?t.percentage=t.percentages[a+1]:r<=-120&&0!==a&&(t.percentage=t.percentages[a-1])}},i=Object.assign({type:\"learning-curve\",learningCurve:function(t){var r=this,a=results.data.find(function(r){return r.job_id==t}),e=results.graph.comparison_id?results.data.find(function(t){return t.job_id==results.graph.comparison_id}):null,n=function(t){return t.train_status&&t.costs&&t.training_errors&&t.validation_errors&&t.train_status.epoch&&\"profile\"!==t.type};if(n(a)){var o=a.costs,l=a.training_errors,s=a.validation_errors,d=(a.train_status.epoch||{}).current;d||(d=1,o=[0],l=[0],s=[0]);for(var c=[],u=[],g=[],h=0;h<d;h++)c.push({id:h+1,value:Number(o[h]),epoch:h+1}),void 0!==l[h]&&u.push({id:h+1,value:Number(l[h]),epoch:h+1}),void 0!==s[h]&&g.push({id:h+1,value:Number(s[h]),epoch:h+1});var v=c.slice(),f=u.slice(),p=g.slice(),m=void 0,x=void 0,y=void 0;if(e&&n(e)&&t!==e.job_id){m=[],x=[],y=[];for(var E=e.costs,_=e.training_errors,T=e.validation_errors,b=(e.train_status.epoch||{}).current,A=0;A<b;A++){var O=E[A];O&&m.push({id:A+1,value:O,epoch:A+1});var G=_[A];G&&0!==G&&x.push({id:A+1,value:G,epoch:A+1});var I=T[A];I&&0!==I&&y.push({id:A+1,value:I,epoch:A+1})}}var F=function(t){return t.value},w=function(t){return t.epoch},M=void 0,k=void 0,S=void 0;if(e&&n(e)&&t!==e.job_id){M=v.concat(f).concat(p).concat(m).concat(x).concat(y),k=f.concat(p).concat(x).concat(y);var z=(e.train_status.epoch||{}).current;S=z>d?z:d}else M=v.concat(f).concat(p),k=f.concat(p),S=d;if(r.width<=r.margin.LEFT||r.height<=r.margin.BOTTOM)$(\".result-learning-curve svg\").remove();else{var H=function(t){return t.map(function(t){return t.value}).filter(function(t){return void 0!==t&&t>0})},P=function(t){return Math.min.apply(void 0,H(t))},R=function(t){return Math.max.apply(void 0,H(t))},L=d3.scale.linear().range([r.margin.LEFT,r.width]).domain([1,S]),W=\"log\"===results.graph.scale?d3.scale.log().range([r.height,r.margin.BOTTOM]).domain([P(M),R(M)]):d3.scale.linear().range([r.height,r.margin.BOTTOM]).domain([P(M),R(M)]),D=\"log\"===results.graph.scale?d3.scale.log().range([r.height,r.margin.BOTTOM]).domain([P(k),R(k)]):d3.scale.linear().range([r.height,r.margin.BOTTOM]).domain([P(k),R(k)]),Y=d3.svg.axis().scale(L).orient(\"bottom\"),N=d3.svg.axis().scale(W).orient(\"left\"),j=d3.svg.axis().scale(D).orient(\"right\"),V=r.createLinePath(L,W,w,F),B=r.createLinePath(L,D,w,F),Z=window.nnc.components.Editor.zoomInfo.learningCurve,C=Z.percentages,U=C[0]/100,J=C[C.length-1]/100;r.zoomY=d3.behavior.zoom().scaleExtent([U,J]).y(W).on(\"zoom\",function(){d3.event.sourceEvent&&i.changeZoomArrayIndex(Z),i.zoomY.scale(Z.percentage/100);var a=r.calcTranslate(r.zoomY);r.zoomY.translate(a),q.translate(a),q.scale(r.zoomY.scale()),d3.select(\".y.axis.axis-left.learning-curve\").call(N),d3.select(\".y.axis.axis-right.learning-curve\").call(j),d3.select(\".y.grid.axis-left.learning-curve\").call(rt),d3.select(\".y.grid.axis-right.learning-curve\").call(at),nt.attr(\"d\",V),ot&&ot.attr(\"d\",B),lt&&lt.attr(\"d\",B),e&&n(e)&&t!==e.resultId&&(st.attr(\"d\",V),dt&&dt.attr(\"d\",B),ct&&ct.attr(\"d\",B)),et.selectAll(\"circle\").remove()}).scale(Z.percentage/100);var q=d3.behavior.zoom().y(D).scale(Z.percentage/100);$(\".result-learning-curve svg\").remove(),r.svg=r.addSVG(r.zoomY);var X=r.addAxisScale(r.svg,Y,\"x axis\",\"translate(0, \"+r.height+\")\",\"black\"),K=r.addAxisScale(r.svg,N,\"y axis axis-left\",\"translate(\"+r.margin.LEFT+\", 0)\",\"#006699\"),Q=r.addAxisScale(r.svg,j,\"y axis axis-right\",\"translate(\"+r.width+\", 0)\",\"#FF6666\"),tt=d3.svg.axis().scale(L).orient(\"bottom\").tickSize(-(r.height-r.margin.BOTTOM),0,0).tickFormat(\"\");r.addGrid(r.svg,tt,\"x grid\",\"translate(0, \"+r.height+\")\",\"#D8D8D8\");var rt=d3.svg.axis().scale(W).orient(\"left\").tickSize(-(r.width-r.margin.LEFT),0,0).tickFormat(\"\");r.addGrid(r.svg,rt,\"y grid axis-left\",\"translate(\"+r.margin.LEFT+\", 0)\",\"rgba(0,102,153,0.20)\");var at=d3.svg.axis().scale(D).orient(\"right\").tickSize(-(r.width-r.margin.LEFT),0,0).tickFormat(\"\");r.addGrid(r.svg,at,\"y grid axis-right\",\"translate(\"+r.width+\", 0)\",\"rgba(255,102,102,0.20)\"),r.addLabel(\".x.axis\",\"Epoch\",r.width/2,40),r.addLabel(\".y.axis-left\",\"Cost\",-40,r.height+35),r.addLabel(\".y.axis-right\",\"Error\",10,r.height+35);var et=r.addChartSVG(r.svg);Y.scale(L),N.scale(W),j.scale(D),X.call(Y),K.call(N),Q.call(j);var it=function(t,a,e,i,n){var o=r.addPath(et,t,a,1,e,n);return o.transition().attr(\"d\",t),o},nt=it(V,\"#006699\",v),ot=void 0,lt=void 0;results.graph.show_training_error&&(ot=it(B,\"#FF6666\",f)),results.graph.show_validation_error&&(lt=it(B,\"#FF6666\",p,0,{\"stroke-dasharray\":\"5, 5\"}));var st=void 0,dt=void 0,ct=void 0;e&&n(e)&&t!==e.resultId&&(st=it(V,\"#006699\",m,0,{opacity:\"0.4\"}),results.graph.show_training_error&&(dt=it(B,\"#FF6666\",x,0,{opacity:\"0.4\"})),results.graph.show_validation_error&&(ct=it(B,\"#FF6666\",y,0,{\"stroke-dasharray\":\"10,5\",opacity:\"0.4\"})))}}}},e),n=Object.assign({type:\"trade-off\",tradeOff:function(){for(var t=this,a=function(t){return JSON.parse(JSON.stringify(t))},e=function(t){for(var r=[],a=0;a<t.length;a++)for(var e=t[a],i=0;i<e.length;i++){for(var n=e[i],o=!1,l=0;l<r.length;l++){var s=r[l];if(n.multiplyAdd===s.multiplyAdd&&(o=!0,n.validationError<s.validationError)){s.validationError=n.validationError;break}}o||r.push(n)}return r=function(t){for(var r=t.length-1;r>=0;r--)for(var a=t[r],e=r-1;e>=0;e--){var i=t[e];if(a.validationError>i.validationError){t.splice(r,1);break}}return t}(r)},o=function(t){return t.multiplyAdd},l=function(t){return t.validationError},s=r.default.GRAPH.TRADE_OFF_PROT_SIZE,d=[\"limegreen\",\"pink\",\"yellow\",\"skyblue\",\"darkred\"],c=function(){switch(results.graph.trade_off_type){case\"All\":return function(t){return!0};case\"Previous\":var t=function(r){var a=ResultsUtils.getActiveResult().job_id,e=r.findIndex(function(t){return t.job_id===a});return t=function(t){return e},e};return function(r,a,e){return t(e)<=a};case\"Pareto Only\":return function(t){return t.pareto_optimal}}}(),u=results.data.filter(function(t){var r=t.train_status;return\"profile\"!==t.type&&\"failed\"!==t.status&&r&&r.last&&void 0!==r.last.train_error&&(r.best&&void 0!==r.best.valid_error||r.last&&void 0!==r.last.valid_error)&&r.cost_multiply_add}).filter(c).map(function(t){var r=new ResultsUtils.JobCostAndErrors(t);return{id:t.job_id,name:t.job_name,trainingError:r.training(),validationError:r.validationBest(),multiplyAdd:r.cost()}}),g=0;g<u.length;++g)u[g].colorIdx=g;u.sort(function(t,r){return t.multiplyAdd-r.multiplyAdd});var h,v=n._calcTradeOffGraphDomain((h=u,d3.min(h,function(t){return t.multiplyAdd})),function(t){return d3.max(t,function(t){return t.multiplyAdd})}(u)),f=v.min,p=v.max,m=n._calcTradeOffGraphDomain(function(t){return Math.min.apply(void 0,t.map(function(t){return t.validationError}).concat(t.map(function(t){return t.trainingError})).filter(function(t){return void 0!==t&&t>0}))}(u),function(t){var r=d3.max(t,function(t){return t.validationError}),a=d3.max(t,function(t){return t.trainingError});return r>a?r:a}(u)),x=m.min,y=m.max;if(t.width<=t.margin.LEFT||t.height<=t.margin.BOTTOM)$(\".result-trade-off svg\").remove();else{var E=d3.scale.log().range([t.margin.LEFT,t.width]).domain([f,p]),_=\"log\"===results.graph.scale?d3.scale.log().range([t.height,t.margin.BOTTOM]).domain([x,y]):d3.scale.linear().range([t.height,t.margin.BOTTOM]).domain([x,y]),T=d3.svg.axis().scale(E).orient(\"bottom\").ticks(10,0),b=d3.svg.axis().scale(_).orient(\"left\").ticks(5),A=t.createLinePath(E,_,o,l),O=window.nnc.components.Editor.zoomInfo.tradeOffGraph,G=O.percentages,I=G[0]/100,F=G[G.length-1]/100;t.zoomY=d3.behavior.zoom().scaleExtent([I,F]).y(_).on(\"zoom\",function(){d3.event.sourceEvent&&i.changeZoomArrayIndex(O),n.zoomY.scale(O.percentage/100),t.zoomY.translate(t.calcTranslate(t.zoomY)),d3.select(\".y.axis.trade-off\").call(b),d3.select(\".y.grid.trade-off\").call(H),S.attr(\"d\",A(e([a(u)]))),u.forEach(P)}).scale(O.percentage/100),$(\".result-trade-off svg\").remove(),t.svg=t.addSVG(t.zoomY);var w=t.addAxisScale(t.svg,T,\"x axis\",\"translate(0, \"+t.height+\")\",\"black\");w.selectAll(\"text\").attr({transform:\"rotate(20)\"}).style(\"text-anchor\",\"start\");var M=t.addAxisScale(t.svg,b,\"y axis\",\"translate(\"+t.margin.LEFT+\", 0)\",\"#FF6666\"),k=t.addChartSVG(t.svg),S=t.addPath(k,A(e([a(u)])),\"rgba(255, 127, 80, .5)\",5,\"\",{class:\"line bottom\"});t.addLabel(\".x.axis\",\"MultiplyAdd\",300,45),t.addLabel(\".y.axis\",\"Error\",-40,t.height+35),E.domain([f,p]),_.domain([x,y]),T.scale(E),b.scale(_),w.call(T),M.call(b);var z=d3.svg.axis().scale(E).orient(\"bottom\").ticks(10,0).tickSize(-(t.height-t.margin.BOTTOM),0,0).tickFormat(\"\");t.addGrid(t.svg,z,\"x grid\",\"translate(0, \"+t.height+\")\");var H=d3.svg.axis().scale(_).orient(\"left\").ticks(5).tickSize(-(t.width-t.margin.LEFT),0,0).tickFormat(\"\");t.addGrid(t.svg,H,\"y grid\",\"translate(\"+t.margin.LEFT+\", 0)\");var P=function(r){var a=\"validation\"+(r.colorIdx+1),e=0<r.validationError?k.selectAll(\"rect.\"+a).data([r]):null,i=\"training\"+(r.colorIdx+1),n=0<r.trainingError?k.selectAll(\"rect.\"+i).data([r]):null,c=2*s,u=function(t){return t==ResultsUtils.getActiveResult().name?c:s},g=function(a,e,i){a.enter().append(\"rect\").attr(\"width\",u(r.name)).attr(\"height\",u(r.name)).attr(i).on(\"mouseover\",function(t){var r=\"Validation\"==e?t.validationError:t.trainingError,a=t.name+\"<br>\"+e+\" Error = \"+r+\"<br>Multiply Add = \"+t.multiplyAdd,i=d3.event.pageY-20,n=d3.event.pageX+10,o=$(\"#tooltip\").outerWidth(!0);return n+o>window.innerWidth&&(n-=o+20),d3.select(\"#tooltip\").style({visibility:\"visible\",top:i+\"px\",left:n+\"px\"}).html(a)}).on(\"mouseout\",function(){return d3.select(\"#tooltip\").style(\"visibility\",\"hidden\")}).on(\"click\",function(){ResultsUtils.changeActive(results.data.find(function(t){return t.job_id==r.id}).job_id)}),a.transition().attr(\"x\",function(a){return E(o(a))-u(r.name)/2-t.margin.LEFT}).attr(\"y\",function(a){return _(\"Validation\"==e?l(a):function(t){return t.trainingError}(a))-u(r.name)/2-t.margin.TOP})};results.graph.show_validation_error&&e&&g(e,\"Validation\",{fill:d[r.colorIdx%d.length],class:a}),results.graph.show_training_error&&n&&g(n,\"Training\",{fill:\"rgba(0, 0, 0, 0)\",stroke:d[r.colorIdx%d.length],class:i})};u.forEach(P)}},_calcTradeOffGraphDomain:function(t,r){if(0!==t){var a=Math.log(r/t);if(t<r&&Math.log(10)<=a)t/=Math.exp(a/20),r*=Math.exp(a/20);else{var e=.5*Math.log(t*r);t=Math.exp(e-.5*Math.log(10)),r=Math.exp(e+.5*Math.log(10))}}return 0===r&&(r=1),{min:t,max:r}}},e);exports.learningCurveGraph=i,exports.tradeOffGraph=n;"},"hash":"986736e7dff133264e02d9aab152320c","cacheData":{"env":{}}}