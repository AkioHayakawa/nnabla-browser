{"dependencies":[{"name":"/home/akiohayakawa/workspace/browser_editor/package.json","includedInParent":true,"mtime":1532065308636},{"name":"./SDUUtils","loc":{"line":1,"column":21}},{"name":"./../EditorUtils","loc":{"line":2,"column":24}},{"name":"./../currentGraph","loc":{"line":3,"column":18}},{"name":"./SDNLayer","loc":{"line":4,"column":18}},{"name":"./../misc/Definitions","loc":{"line":5,"column":24}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var t=require(\"./SDUUtils\"),e=f(t),n=require(\"./../EditorUtils\"),r=f(n),o=require(\"./../currentGraph\"),i=f(o),u=require(\"./SDNLayer\"),a=f(u),s=require(\"./../misc/Definitions\"),l=f(s);function f(t){return t&&t.__esModule?t:{default:t}}var c=function t(){var n=this;window.svgArea=this;var o=l.default.EDIT.GRID.SIZE,u=l.default.EDIT.GRID.RADIUS,s=d3.select(l.default.EDIT.SVG_ID),f=s.append(\"g\").attr(\"name\",\"background\"),c=s.append(\"g\").attr(\"name\",\"layers\").attr(\"id\",\"network-editor-nodes\"),d=s.append(\"g\").attr(\"name\",\"links\").attr(\"id\",\"network-editor-links\"),I=s.append(\"g\").attr(\"name\",\"focuses\").attr(\"id\",\"network-editor-focuses\"),y=f.append(\"g\").attr(\"name\",\"grid-dots\").style(\"display\",\"none\");this.layerGroup=function(){return c},this.linkGroup=function(){return d},this.focusGroup=function(){return I},this.showGrid=function(){return y.style(\"display\",null)},this.hideGrid=function(){return y.style(\"display\",\"none\")};var h=function(t,e){y.selectAll(\"circle\").remove(),function(t,e){for(var n=[],r=parseInt((t+o-1)/o)+1,i=parseInt((e+o-1)/o)+1,u=0;u<=i;u++)for(var a=0;a<=r;a++)n.push({x:o*a,y:o*u});return n}(t,e).forEach(function(t){return y.append(\"circle\").attr(\"cx\",t.x).attr(\"cy\",t.y).attr(\"r\",u).attr(\"pointer-events\",\"none\").style(\"fill\",\"lightgray\")})};this.width=function(){return parseInt(s.style(\"width\"))},this.height=function(){return parseInt(s.style(\"height\"))};var E=$(\".network-editor-scroller\"),p=function(){return E.width()},D=function(){return E.height()},v=function(t,e,n){var r=i.default.layers().filter(function(t){return(!n||-1==n.indexOf(t))&&e-o-1<t.getPosition().y&&t.getPosition().y<e+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT});r.sort(function(t,e){return t.getPosition().x-e.getPosition().x});var u=void 0,a=t;if(0===r.length)return a;if(r[0].getPosition().x-l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH>=a)return a;for(u=1;u<r.length;u++){var s=r[u-1],f=r[u],c=s.getPosition().x+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH>a?s.getPosition().x+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH:a;if(f.getPosition().x-c>=l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH)return c}return r[r.length-1].getPosition().x+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH<=a?a:r[r.length-1].getPosition().x+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH},g=function(t,e){var n=i.default.layers().filter(function(e){var n=e.getPosition().x,r=n+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH,i=t+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH-o;return t>=n&&t<=r||i>=n&&i<=r});if(0===n.length)return e;n.sort(function(t,e){return t.getPosition().x-e.getPosition().x});for(var r=e,u=0;u<n.length;u++){var a=n[u],s=r+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT,f=a.getPosition().y,c=f+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT;(r>=f||s>f||r<=c)&&(r=f)}return r+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT+o},T=function(t,e){var n=function(t){return Math.min.apply(null,t)},r=function(t){return Math.max.apply(null,t)},o=t.map(function(t){return t.x}),i=t.map(function(t){return t.y});return{left:n(o)-e,top:n(i)-e,right:r(o)+l.default.EDIT.LAYER.BOUNDING_BOX.WIDTH+e,bottom:r(i)+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT+e}};this.calcLayerDropPosition=function(t,e){var n=function(t){var e=function(t){return Math.max(0,parseInt((t+o/2)/o)*o)};return{x:e(t.x),y:e(t.y)}}(t.getPosition());return{x:v(n.x,n.y,e||[t]),y:n.y}};var O=document.getElementById(\"network-editor\"),m=Math.max,x=function(t){var e=window.nnc.components.Editor.zoomInfo.networkGraph.percentage/100,n=m(p(),t.right*e),r=m(D(),t.bottom*e),o=n/e,i=r/e;O.setAttribute(\"viewBox\",\"0 0 \"+o+\" \"+i),function(t,e){s.style(\"width\",t),s.style(\"height\",e)}(n,r),h(o,i)},L=function(t){var e=T(i.default.layers(function(t){return t.getPosition()}),o);if(x(e),t){var n=T(t.map(function(t){return t.getPosition()}),0),r=p(),u=D(),a=E.scrollLeft(),s=a+r;n.left<a?E.scrollLeft(n.left):s<n.right&&E.scrollLeft(n.right-r);var l=E.scrollTop(),f=l+u;n.top<l?E.scrollTop(n.top):f<n.bottom&&E.scrollTop(n.bottom-u)}};this.requestAdjustSize=L,this.trackCursorMovement=function(t){var e=p(),n=D(),r=window.nnc.components.Editor.zoomInfo.networkGraph.percentage/100,o=t.x*r,i=t.y*r,u=E.scrollLeft(),a=u+e,s=E.scrollTop(),l=s+n;(a<o||l<i)&&L(),o<u?E.scrollLeft(o):a<o&&E.scrollLeft(o-e),i<s?E.scrollTop(i):l<i&&E.scrollTop(i-n)},this.addLayer=function(t){var e=void 0,u=void 0;return window.nnc.components.Editor.history.execute({type:\"push-and-execute\",argument:{exec:function(){var s=void 0;if(e)s=a.default.deserialize(e);else{var f=function(t){var e=r.default.getComponent(t),n=o,u=o;if(\"top\"==e.layout)n=v(n,u);else{var a=i.default.selection.layer.focused();a?(n=a.getPosition().x,u=0===a.component().output?a.getPosition().y+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT+o:a.getPosition().y+l.default.EDIT.LAYER.BOUNDING_BOX.HEIGHT,n=v(n,u)):u=g(n,u)}return{x:n,y:u}}(t);s=new a.default({type:t,x:f.x,y:f.y},n),e=s.serialize()}i.default.selection.clear(),i.default.selection.layer.focus(s),u=s.autoLink(),L([s])},undo:function(){u.undo(),u=void 0,a.default.findObjectBySerialized(e).remove(),L()},name:function(){return\"Add layer : \"+t}}})},this.createLayerDestinationFrame=function(e){var n=f.append(\"rect\").attr(\"x\",e.x).attr(\"y\",e.y).attr(\"width\",l.default.EDIT.LAYER.DESTINATION_FRAME.WIDTH).attr(\"height\",l.default.EDIT.LAYER.DESTINATION_FRAME.HEIGHT).style(\"fill\",l.default.EDIT.LAYER.DESTINATION_FRAME.FILL_COLOR).style(\"stroke\",l.default.EDIT.LAYER.DESTINATION_FRAME.STROKE_COLOR).style(\"stroke-width\",l.default.EDIT.LAYER.DESTINATION_FRAME.STROKE_WIDTH);return{move:function(t){n.attr(\"x\",t.x).attr(\"y\",t.y)},getPosition:function(){return{x:parseInt(n.attr(\"x\")),y:parseInt(n.attr(\"y\"))}},destroy:function(){t.hideAndRemove(n),n=void 0}}};var A=function(e){1===d3.event.sourceEvent.buttons&&i.default.selection.clear();var n,r=i.default.layers(function(t){var e=t.getPosition(),n=t.frameSize();return{target:t,rect:{left:e.x,top:e.y,right:e.x+n.width,bottom:e.y+n.height}}}),o=(n=I.append(\"rect\").style(\"fill\",l.default.EDIT.LASSO.FILL_COLOR).style(\"stroke\",l.default.EDIT.LASSO.STROKE_COLOR).style(\"stroke-width\",l.default.EDIT.LASSO.STROKE_WIDTH),{move:function(t,e){var r=Math.min(t.x,e.x),o=Math.min(t.y,e.y),i=Math.max(t.x,e.x),u=Math.max(t.y,e.y);return n.attr(\"x\",r).attr(\"y\",o).attr(\"width\",i-r).attr(\"height\",u-o),function(t){return r<=t.left&&t.right<=i&&o<=t.top&&t.bottom<=u}},destroy:function(){t.hideAndRemove(n),n=void 0}});return{move:function(t){var n=o.move(e,t),u=r.filter(function(t){return n(t.rect)}).map(function(t){return t.target});i.default.selection.change(u)},destroy:function(){o.destroy(),o=void 0}}},N=void 0;this.setDragContext=function(t){if(N)throw\"Error: previous context not cleared correctly.\";N=t},this.draggingLayer=function(){return!!N};var R=function(t){var e=d3.mouse(t);return{x:e[0],y:e[1]}},B=new e.default.Set;this.subscribeMouseEnter=function(t){return B.insert(t)},this.unsubscribeMouseEnter=function(t){return B.remove(t)},s.on(\"mouseenter\",function(){var t=d3.mouse(this);B.apply(function(e){return e({x:t[0],y:t[1]})})}).on(\"click\",function(){O.focus()}).call(d3.behavior.drag().on(\"dragstart\",function(){N=N||A(R(this))}).on(\"drag\",function(){N.move(R(this))}).on(\"dragend\",function(){N.destroy(),N=void 0}))};c.hideAndRemove=function(t){t&&t.transition().style(\"opacity\",0).each(\"end\",function(){return t.remove()})},exports.default=c;"},"hash":"ab052421648db255f95b133fa9c3aa0a","cacheData":{"env":{}}}