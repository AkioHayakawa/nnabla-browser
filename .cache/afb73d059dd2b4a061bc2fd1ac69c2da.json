{"dependencies":[{"name":"/home/akiohayakawa/workspace/browser_editor/package.json","includedInParent":true,"mtime":1532065308636},{"name":"/home/akiohayakawa/workspace/browser_editor/node_modules/csvtojson/package.json","includedInParent":true,"mtime":1531826268619},{"name":"./Processor","loc":{"line":16,"column":26}},{"name":"bluebird","loc":{"line":17,"column":41}},{"name":"./dataClean","loc":{"line":18,"column":26}},{"name":"./getEol","loc":{"line":19,"column":39}},{"name":"./fileline","loc":{"line":20,"column":25}},{"name":"./util","loc":{"line":21,"column":21}},{"name":"./rowSplit","loc":{"line":22,"column":25}},{"name":"./lineToJson","loc":{"line":23,"column":43}},{"name":"./CSVError","loc":{"line":24,"column":41}},{"name":"buffer"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer,t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,\"__esModule\",{value:!0});var i=require(\"./Processor\"),n=r(require(\"bluebird\")),s=require(\"./dataClean\"),o=r(require(\"./getEol\")),u=require(\"./fileline\"),a=require(\"./util\"),l=require(\"./rowSplit\"),h=r(require(\"./lineToJson\")),f=r(require(\"./CSVError\")),d=function(r){function i(){var e=null!==r&&r.apply(this,arguments)||this;return e.rowSplit=new l.RowSplit(e.converter),e.eolEmitted=!1,e._needEmitEol=void 0,e.headEmitted=!1,e._needEmitHead=void 0,e}return t(i,r),i.prototype.flush=function(){var e=this;if(this.runtime.csvLineBuffer&&this.runtime.csvLineBuffer.length>0){var t=this.runtime.csvLineBuffer;return this.runtime.csvLineBuffer=void 0,this.process(t,!0).then(function(t){return e.runtime.csvLineBuffer&&e.runtime.csvLineBuffer.length>0?n.default.reject(f.default.unclosed_quote(e.runtime.parsedLineNumber,e.runtime.csvLineBuffer.toString())):n.default.resolve(t)})}return n.default.resolve([])},i.prototype.destroy=function(){return n.default.resolve()},Object.defineProperty(i.prototype,\"needEmitEol\",{get:function(){return void 0===this._needEmitEol&&(this._needEmitEol=this.converter.listeners(\"eol\").length>0),this._needEmitEol},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"needEmitHead\",{get:function(){return void 0===this._needEmitHead&&(this._needEmitHead=this.converter.listeners(\"header\").length>0),this._needEmitHead},enumerable:!0,configurable:!0}),i.prototype.process=function(e,t){var r,i=this;return void 0===t&&(t=!1),r=t?e.toString():s.prepareData(e,this.converter.parseRuntime),n.default.resolve().then(function(){return i.runtime.preRawDataHook?i.runtime.preRawDataHook(r):r}).then(function(e){return e&&e.length>0?i.processCSV(e,t):n.default.resolve([])})},i.prototype.processCSV=function(e,t){var r=this,i=this.params,s=this.runtime;s.eol||o.default(e,s),this.needEmitEol&&!this.eolEmitted&&s.eol&&(this.converter.emit(\"eol\",s.eol),this.eolEmitted=!0),i.ignoreEmpty&&!s.started&&(e=a.trimLeft(e));var l=u.stringToLines(e,s);if(t?(l.lines.push(l.partial),l.partial=\"\"):this.prependLeftBuf(a.bufFromString(l.partial)),l.lines.length>0){return(s.preFileLineHook?this.runPreLineHook(l.lines):n.default.resolve(l.lines)).then(function(e){return s.started||r.runtime.headers?r.processCSVBody(e):r.processDataWithHead(e)})}return n.default.resolve([])},i.prototype.processDataWithHead=function(e){if(this.params.noheader)this.params.headers?this.runtime.headers=this.params.headers:this.runtime.headers=[];else{for(var t=\"\",r=[];e.length;){var i=t+e.shift(),n=this.rowSplit.parse(i);if(n.closed){r=n.cells,t=\"\";break}t=i+o.default(i,this.runtime)}if(this.prependLeftBuf(a.bufFromString(t)),0===r.length)return[];this.params.headers?this.runtime.headers=this.params.headers:this.runtime.headers=r}return(this.runtime.needProcessIgnoreColumn||this.runtime.needProcessIncludeColumn)&&this.filterHeader(),this.needEmitHead&&!this.headEmitted&&(this.converter.emit(\"header\",this.runtime.headers),this.headEmitted=!0),this.processCSVBody(e)},i.prototype.filterHeader=function(){if(this.runtime.selectedColumns=[],this.runtime.headers){for(var e=this.runtime.headers,t=0;t<e.length;t++)if(this.params.ignoreColumns)if(this.params.ignoreColumns.test(e[t])){if(!this.params.includeColumns||!this.params.includeColumns.test(e[t]))continue;this.runtime.selectedColumns.push(t)}else this.runtime.selectedColumns.push(t);else this.params.includeColumns?this.params.includeColumns.test(e[t])&&this.runtime.selectedColumns.push(t):this.runtime.selectedColumns.push(t);this.runtime.headers=a.filterArray(this.runtime.headers,this.runtime.selectedColumns)}},i.prototype.processCSVBody=function(e){if(\"line\"===this.params.output)return e;var t=this.rowSplit.parseMultiLines(e);return this.prependLeftBuf(a.bufFromString(t.partial)),\"csv\"===this.params.output?t.rowsCells:h.default(t.rowsCells,this.converter)},i.prototype.prependLeftBuf=function(t){t&&(this.runtime.csvLineBuffer?this.runtime.csvLineBuffer=e.concat([t,this.runtime.csvLineBuffer]):this.runtime.csvLineBuffer=t)},i.prototype.runPreLineHook=function(e){var t=this;return new n.default(function(r,i){p(e,t.runtime,0,function(t){t?i(t):r(e)})})},i}(i.Processor);function p(e,t,r,i){if(r>=e.length)i();else if(t.preFileLineHook){var n=e[r],s=t.preFileLineHook(n,t.parsedLineNumber+r);if(r++,s&&s.then)s.then(function(n){e[r-1]=n,p(e,t,r,i)});else{for(e[r-1]=s;r<e.length;)e[r]=t.preFileLineHook(e[r],t.parsedLineNumber+r),r++;i()}}else i()}exports.ProcessorLocal=d;"},"hash":"5591af31ce485c85d6085a99d43b545f","cacheData":{"env":{}}}