{"dependencies":[{"name":"/home/akiohayakawa/workspace/browser_editor/package.json","includedInParent":true,"mtime":1532065308636},{"name":"./SDNConnector","loc":{"line":1,"column":22}},{"name":"./editor","loc":{"line":2,"column":19}},{"name":"./../currentGraph","loc":{"line":3,"column":18}},{"name":"./../misc/Definitions","loc":{"line":4,"column":24}},{"name":"./SDNSvgArea","loc":{"line":5,"column":20}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"./SDNConnector\"),t=l(e),n=require(\"./editor\"),i=l(n),o=require(\"./../currentGraph\"),r=l(o),a=require(\"./../misc/Definitions\"),u=l(a),s=require(\"./SDNSvgArea\"),d=l(s);function l(e){return e&&e.__esModule?e:{default:e}}var c=void 0;!function(){var e=u.default.EDIT.LINK.FOCUSED_DRAG.STROKE_WIDTH,n=u.default.EDIT.LINK.FOCUSED_DRAG.STROKE_COLOR,o=Math.abs,a=u.default.EDIT.CONNECTOR.OUT,s=function(e,t){return e.layer()===t.layer()};c=function(d,l,f,y){var _=this;this._source=f,this._destination=y;var v=function(u){var l=function(e){return _._linkLine.attr(\"opacity\",e)},f=_._source,y=_._destination,v=function(e,t,n){var i=e.x,r=e.y,a=void 0,u=void 0;return a=t.getPosition().y,u=n.getPosition().y,o(a-r)<o(r-u)?t:(a=t.getPosition().x,u=n.getPosition().x,o(a-i)<o(i-u)?t:n)}(u,f,y),h=v===f?y:f;l(0);var m,O=t.default.mkLinkEdge(d,v.getPosition()),E=t.default.mkLinkEdge(d,h.getPosition()),T=(m=_,d.append(\"path\").attr(\"d\",c.getPathData(m._destination.getPosition(),m._source,m._destination)).attr(\"stroke-width\",e).attr(\"stroke\",n).attr(\"fill\",\"none\")),g=void 0;return r.default.selection.clear(),r.default.selection.layer.focus(h.layer(),v.layer()),{move:function(e){var t=void 0;t=(g=function(e){var t=i.default.touchingConnector();if(t&&!s(t,e)&&(e.getType()===a||t.isDefault()))return t;var n=i.default.stockedLayer();if(n){var o=e.getType()===a?n._inConnector:n._outConnector;if(o&&!s(o,e))return o}}(h))&&g.canConnect()&&!g.connectedWith(h)||g===v&&g.connectedWith(h)?g.getPosition():e,function(e,t,n,i,o){n.attr(\"d\",c.getPathData(o,e,t)),i.attr(\"cx\",o.x).attr(\"cy\",o.y)}(h,g,T,O,t),r.default.selection.layer.clear(),r.default.selection.layer.focus(h.layer()),g&&r.default.selection.layer.insert(g.layer())},destroy:function(){var e=void 0;if(l(null),g&&g.canConnect()){var n=void 0,i=void 0;g.getType()===a?(n=g,i=h):(n=h,i=g);var o=(e=n.linkTo(i)).serialize(),u=_.serialize();_.remove(),window.nnc.components.Editor.history.execute({type:\"push\",argument:{exec:function(){c.deserialize(o),c.findObjectBySerialized(u).remove()},undo:function(){c.findObjectBySerialized(o).remove(),c.deserialize(u)},name:function(){return\"Edit link\"}}})}else e=_;r.default.selection.clear(),r.default.selection.link.focus(e),T&&(T.remove(),T=void 0),t.default.safeRemoveLinkingConnector(E),t.default.safeRemoveLinkingConnector(O)}}},h=d3.behavior.drag().on(\"dragstart\",function(){if(1===d3.event.sourceEvent.buttons){var e=d3.mouse(this);l.set(v({x:e[0],y:e[1]}))}});this._linkLine=d.append(\"path\").attr(\"d\",c.getPathData(y.getPosition(),f,y)).style(\"stroke-width\",u.default.EDIT.LINK.DEFAULT.STROKE_WIDTH).style(\"stroke\",u.default.EDIT.LINK.STROKE_COLOR).style(\"fill\",\"none\").call(h),r.default.insertLink(this)}}(),function(){var e=u.default.EDIT.LINK.FOCUSED.STROKE_COLOR,t=u.default.EDIT.LINK.STROKE_COLOR;c.prototype.select=function(n){this._linkLine.style(\"stroke\",n?e:t),this.source().select(n),this.destination().select(n)}}(),c._mkLinkedCircle=function(e,t,n){return e.append(\"circle\").attr(\"cx\",t).attr(\"cy\",n).attr(\"r\",u.default.EDIT.LAYER.CONNECTOR.JOIN_RADIUS).attr(\"fill\",u.default.EDIT.LAYER.CONNECTOR.STROKE_COLOR).attr(\"pointer-events\",\"none\")},c.prototype.source=function(){return this._source},c.prototype.destination=function(){return this._destination},c.prototype.serialize=function(){return{from_node:this._source.layer().name(),from_name:this._source.name(),to_node:this._destination.layer().name(),to_name:this._destination.name()}},function(){var e=u.default.EDIT.CONNECTOR.OUT,t=u.default.EDIT.CONNECTOR.IN,n={getInConnector:function(){},getOutConnector:function(){}},i=function(i,o,a){var u=r.default.layers().find(function(e){return e.name()===o})||n;switch(i){case t:return u.getInConnector(a);case e:return u.getOutConnector(a);default:return}},o=function(e){return\"source\"in e?{from_node:e.source.nodeName,from_name:e.source.name,to_node:e.destination.nodeName,to_name:e.destination.name}:e};c.deserialize=function(n){n=o(n);var r=i(e,n.from_node,n.from_name),a=i(t,n.to_node,n.to_name);return r&&a?r.linkTo(a):null},c.findObjectBySerialized=function(n){n=o(n);var r=i(e,n.from_node,n.from_name);if(r){var a=i(t,n.to_node,n.to_name);return r.links().find(function(e){return e.destination()===a})||null}return null}}(),c.prototype.updateLinkLine=function(){var e=this._source,t=this._destination;e&&t&&this._linkLine.attr(\"d\",c.getPathData(t.getPosition(),e,t))},c.prototype.resetConnectors=function(e,t){this._source=e,this._destination=t,this._linkLine.attr(\"d\",c.getPathData(t.getPosition(),e,t))},c.getPathData=function(e,t,n){var i=Math.max,o=u.default.EDIT.GRID.SIZE,r=o/2,a=t.getPosition(),s=n?n.getPosition().x+7.5*o:-1/0;return t.name()||n&&n.name()?\"M \"+a.x+\",\"+a.y+\" L \"+e.x+\",\"+e.y:t.getType()===u.default.EDIT.CONNECTOR.OUT?a.y<=e.y?\"M \"+a.x+\",\"+a.y+\" L \"+e.x+\",\"+e.y:\"M \"+a.x+\",\"+a.y+\" v \"+o+\" a \"+r+\",\"+r+\" 0 0,0 \"+r+\",\"+r+\" H \"+i(a.x+7.5*o,e.x+2.5*o,s)+\" a \"+r+\",\"+r+\" 0 0,0 \"+r+\",\"+-r+\" V \"+(e.y-o)+\" a \"+r+\",\"+r+\" 0 0,0 \"+-r+\",\"+-r+\" H \"+(e.x+r)+\" a \"+r+\",\"+r+\" 0 0,0 \"+-r+\",\"+r+\" V \"+e.y:a.y>=e.y?\"M \"+a.x+\",\"+a.y+\" L \"+e.x+\",\"+e.y:\"M \"+a.x+\",\"+a.y+\" v \"+-o+\" a \"+r+\",\"+r+\" 0 0,1 \"+r+\",\"+-r+\" H \"+i(a.x+7.5*o,e.x+2.5*o,s)+\" a \"+r+\",\"+r+\" 0 0,1 \"+r+\",\"+r+\" V \"+(e.y+o)+\" a \"+r+\",\"+r+\" 0 0,1 \"+-r+\",\"+r+\" H \"+(e.x+r)+\" a \"+r+\",\"+r+\" 0 0,1 \"+-r+\",\"+-r+\" V \"+e.y},c.prototype.remove=function(){d.default.hideAndRemove(this._linkLine),r.default.removeLink(this),delete this._source,delete this._destination,delete this._linkLine},exports.default=c;"},"hash":"ed1b586530755969dc9446f877fcf8d9","cacheData":{"env":{}}}