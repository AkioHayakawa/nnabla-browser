{"dependencies":[{"name":"/home/akiohayakawa/workspace/browser_editor/package.json","includedInParent":true,"mtime":1532065308636},{"name":"./editor","loc":{"line":1,"column":19}},{"name":"./../currentGraph","loc":{"line":2,"column":18}},{"name":"./../misc/Definitions","loc":{"line":3,"column":24}},{"name":"./SDNLink","loc":{"line":4,"column":17}},{"name":"./SDNSvgArea","loc":{"line":5,"column":20}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var t=require(\"./editor\"),e=f(t),n=require(\"./../currentGraph\"),r=f(n),i=require(\"./../misc/Definitions\"),o=f(i),a=require(\"./SDNLink\"),u=f(a),l=require(\"./SDNSvgArea\"),c=f(l);function f(t){return t&&t.__esModule?t:{default:t}}var s=function(){var t=o.default.EDIT.CONNECTOR.OUT,e=function(t){return r.default.links().filter(function(e){return e._source===t})},n=function(t){return r.default.links().filter(function(e){return e._destination===t})},i=function(){throw\"ERROR: attempted making link from Input connector.\"};return function(r,a,l,c,f,d,E,O,h,y){var p=this;this._layer=r,this._type=f,this._name=E,f===t?(this.links=function(){return e(p)},this.connectedWith=function(t){return e(p).some(function(e){return e._destination===t})}):(this.links=function(){return n(p)},this.connectedWith=function(t){return n(p).some(function(e){return e._source===t})}),this.linkTo=f===t?function(e,n,r){return function(i){if(i._type===t)throw\"ERROR: attempted making link to Output connector.\";if(e.connectedWith(i))throw\"ERROR: attempted making link with already linked Input connector.\";return new u.default(n,r,e,i)}}(this,l,c):i,h=h.replace(/0x/,\"#\"),this._mainImage=s._mkConnectorCircle(a,y.x,y.y,h),O?(this._mainImage.attr(\"r\",o.default.EDIT.LAYER.CONNECTOR.SIDE.RADIUS).style(\"stroke-width\",o.default.EDIT.LAYER.CONNECTOR.STROKE_WIDTH).style(\"opacity\",o.default.EDIT.LAYER.CONNECTOR.SIDE.OPACITY).call(this.bindEvent,this),this._label=a.append(\"text\").attr(\"x\",y.x).attr(\"y\",y.y+o.default.EDIT.LAYER.CONNECTOR.SIDE.LABEL.OFFSET_Y).attr(\"pointer-events\",\"none\").text(O).style(\"fill\",o.default.EDIT.LAYER.CONNECTOR.SIDE.LABEL.FONTCOLOR).style(\"font-size\",o.default.EDIT.LAYER.CONNECTOR.SIDE.LABEL.FONTSIZE).style(\"font-weight\",o.default.EDIT.LAYER.CONNECTOR.SIDE.LABEL.FONTWEIGHT).style(\"text-anchor\",\"middle\").style(\"opacity\",o.default.EDIT.LAYER.CONNECTOR.SIDE.LABEL.OPACITY)):this._mainImage.call(this._makeEventAttacher(c,l)),this.linkingLimit=function(){return p.isDefault()?f===o.default.EDIT.CONNECTOR.IN?r.component().input:r.component().output:1}}}();s._mkConnectorCircle=function(t,e,n,r){return t.append(\"circle\").attr(\"cx\",e).attr(\"cy\",n).attr(\"r\",o.default.EDIT.LAYER.CONNECTOR.RADIUS).attr(\"fill\",r)},s.safeRemoveLinkingConnector=function(t){t&&(t.remove(),t=void 0)},s._mkLinkPath=function(t,e,n){var r=o.default.EDIT.LINK;return t.append(\"path\").attr(\"d\",\"M\"+[e,n]+\"L\"+[e,n]).attr(\"stroke-width\",r.FOCUSED_DRAG.STROKE_WIDTH).attr(\"stroke\",r.FOCUSED_DRAG.STROKE_COLOR).attr(\"fill\",\"none\").attr(\"filter\",r.FOCUSED_DRAG.FILTER_URL)},s.mkLinkEdge=function(t,e){return t.append(\"circle\").attr(\"cx\",e.x).attr(\"cy\",e.y).attr(\"r\",o.default.EDIT.LAYER.CONNECTOR.RADIUS).attr(\"fill\",o.default.EDIT.LINK.FOCUSED.STROKE_COLOR).attr(\"pointer-events\",\"none\").attr(\"filter\",o.default.EDIT.LINK.FOCUSED_DRAG.FILTER_URL)},s.prototype._makeEventAttacher=function(t,n){var i=this;return d3.behavior.drag().on(\"dragstart\",function(){return t.set((a=i._layer,l=i._type,f=(c=i).getPosition(),d=s.mkLinkEdge(n,f),E=s.mkLinkEdge(n,f),O=s._mkLinkPath(n,f.x,f.y),r.default.selection.clear(),r.default.selection.layer.focus(a),{move:function(t){var n=void 0,i=void 0,f=e.default.stockedLayer();f&&f!==a?(n=l===o.default.EDIT.CONNECTOR.OUT?e.default.touchingConnector()||f._inConnector:f._outConnector)&&n.canConnect()?(i=n.getPosition(),r.default.selection.layer.focus(a,f)):i=t:(i=t,r.default.selection.layer.clear(),r.default.selection.layer.focus(a)),O.attr(\"d\",u.default.getPathData(i,c,n)),E.attr(\"cx\",i.x).attr(\"cy\",i.y)},destroy:function(){var t=c.connect();r.default.selection.clear(),t&&r.default.selection.link.focus(t),O&&(O.remove(),O=void 0),s.safeRemoveLinkingConnector(E),s.safeRemoveLinkingConnector(d)}}));var a,l,c,f,d,E,O})},s.prototype.bindEvent=function(t,n){t.on({mouseenter:function(){e.default.stockLayer(n._layer),e.default.touchConnector(n)},mouseleave:function(){e.default.stockLayer(null),e.default.touchConnector(null)}})},s.prototype.getPosition=function(){var t=this._layer.getPosition(),e=this._mainImage;return{x:t.x+Number(e.attr(\"cx\")),y:t.y+Number(e.attr(\"cy\"))}},s.prototype.getType=function(){return this._type},s.prototype.remove=function(){c.default.hideAndRemove(this._mainImage),c.default.hideAndRemove(this._label),this.links().forEach(function(t){return t.remove()})},s.prototype.name=function(){return this._name},s.prototype.layer=function(){return this._layer},s.prototype.canConnect=function(){var t=this.linkingLimit();return-1===t||1===t&&0===this.links().length},s.prototype.isDefault=function(){return\"\"===this._name},function(){var t=o.default.EDIT.LINK.FOCUSED.STROKE_COLOR,e=o.default.EDIT.LAYER.CONNECTOR.STROKE_COLOR;s.prototype.select=function(n){this.isDefault()&&this._mainImage.attr(\"fill\",n?t:e)}}(),s.prototype.connect=function(){var t=this,n=e.default.touchingConnector();if(!n){var r=e.default.stockedLayer();r&&(n=t.getType()===o.default.EDIT.CONNECTOR.IN?r.getOutConnector():r.getInConnector())}if(!n)return null;if(n._layer===t._layer)return null;if(n.getType()===t.getType())return null;if(n.connectedWith(t))return null;if(n.getType()===o.default.EDIT.CONNECTOR.OUT){var i=t;t=n,n=i}if(!n.isDefault()&&n.links().length>0)return null;var a=[];if(!t.canConnect()){var l=t.links();a.push(l[0].serialize())}if(!n.canConnect()){var c=n.links();a.push(c[0].serialize())}a.forEach(function(t){return u.default.findObjectBySerialized(t).remove()});var f=t.linkTo(n).serialize();window.nnc.components.Editor.history.execute({type:\"push\",argument:{exec:function(){a.forEach(function(t){return u.default.findObjectBySerialized(t).remove()}),u.default.deserialize(f)},undo:function(){u.default.findObjectBySerialized(f).remove(),a.forEach(u.default.deserialize)},name:function(){return\"Edit link\"}}})},exports.default=s;"},"hash":"bc61301738c3d3118b656fa01a7bfeb0","cacheData":{"env":{}}}